<?xml version="1.0" encoding="UTF-8" ?>
<Module>
<ModulePrefs title="Connecting to Survey Gizmo with oAuth" />
<Content type="html"><![CDATA[
<script type="text/javascript">

function getRequestToken(){

  var params = {};
	params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.TEXT;

	//params[gadgets.io.RequestParameters.OAUTH_CONSUMER_KEY] = a3144542aad2f2cc9984abd9a722894c0505ea4ea;
	//params[gadgets.io.RequestParameters.oauth_consumer_key] = a3144542aad2f2cc9984abd9a722894c0505ea4ea;

	//var url = "https://restapi.surveygizmo.com/head/oauth/request_token&oauth_consumer_key=a3144542aad2f2cc9984abd9a722894c0505ea4ea&oauth_callback=testfunc";

	var url = "https://restapi.surveygizmo.com/head/oauth/request_token?oauth_consumer_key=a3144542aad2f2cc9984abd9a722894c0505ea4ea&oauth_signature_method=PLAINTEXT&oauth_signature=kd94hf93k423kf44%26&oauth_timestamp=1191242090&oauth_nonce=hsu94j3884jdopsl&oauth_version=1.0";

	gadgets.io.makeRequest(url, response, params);
}


function response(obj) {
	//obj.text contains the text of the page that was requested
	if (obj.text) {
		var str = obj.text;
		var html = str.substr(0,400);
		var position = str.search("oauth_token");
		document.write(position);
		document.getElementById('returned_text').innerHTML = html;

		// This is where authorization takes place
		params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.TEXT;
		var newurl = "http://restapi.surveygizmo.com/head/oauth/authenticate?oauth_token=4b9dff7a0205916c27f536e28be0d4260505ff846";
		//var newurl = http://restapi.surveygizmo.com/head/oauth/authenticateoauth_token=4b9dff7a0205916c27f536e28be0d4260505ff846&oauth_callback=http://url.com/;
		gadgets.io.makeRequest(newurl, response, params);


		
		
	}

	if (obj.errors) {
		document.getElementById('returned_errors').innerHTML = obj.errors;
	}
};

</script>

<button onclick="getRequestToken()">Create Survey in SurveyGizmo</button>

	<br> 
	Any errors will be listed here :
		<div id="returned_errors">
			No Errors
		</div>
	       
	Retrieved text will be shown here :
	<div id="returned_text">
		No Text
	</div>
	<br/>

]]></Content>
</Module>
